<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="60">
    <title>Speed Test, Uptime and Downtime Results</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link the CSS file -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Speed Test Results</h1>
    <button id="toggleMode">Switch to Light Mode</button>
    <form action="logs.html">
        <input type="submit" value="SEE LOGS" />
    </form>
    
    <canvas id="myChart" width="400" height="200"></canvas>

    <h2>Downtime Logs</h2>
    <table id="downtimeTable">
        <thead>
            <tr>
                <th>Host</th>
                <th>Timestamp</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Downtime data will be inserted here -->
        </tbody>
    </table>

    <h2>Uptime Logs</h2>
    <table id="uptimeTable">
        <thead>
            <tr>
                <th>Host</th>
                <th>Timestamp</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Uptime data will be inserted here -->
        </tbody>
    </table>

    <h2>Ping Results</h2>
    <table id="pingTable">
        <thead>
            <tr>
                <th>Host</th>
                <th>Alive</th>
                <th>Response Times (ms)</th>
            </tr>
        </thead>
        <tbody>
            <!-- Ping results will be inserted here -->
        </tbody>
    </table>

    <script>
        // Function to fetch speed test results and create chart
            const fetchSpeedTestResults = async () => {
            const response = await fetch('/results');
            const data = await response.json();
                console.log(data)
            // Check if data is not empty
            if (data.length === 0) {
                console.error('No speed test results found.');
                return;
            }

            const timestamps = data.map(d => d.timestamp);
            const downloadSpeeds = data.map(d => d.speedResults2.download);
            const uploadSpeeds = data.map(d => d.speedResults2.upload);
            
            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timestamps,
                    datasets: [
                        {
                            label: 'Download Speed (Mbps)',
                            data: downloadSpeeds,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            fill: false,
                        },
                        {
                            label: 'Upload Speed (Mbps)',
                            data: uploadSpeeds,
                            borderColor: 'rgba(153, 102, 255, 1)',
                            fill: false,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        };

        // Function to fetch downtime logs and populate the table
        const fetchDowntimeLogs = async () => {
            const response = await fetch('/downtime');
            const downtimeData = await response.json();
            const tbody = document.getElementById('downtimeTable').getElementsByTagName('tbody')[0];

            downtimeData.forEach(log => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = log.host;
                row.insertCell(1).textContent = log.timestamp;
                row.insertCell(2).textContent = log.status;
            });
        };

        // Function to fetch uptime logs and populate the table
        const fetchUptimeLogs = async () => {
            const response = await fetch('/uptime');
            const uptimeData = await response.json();
            const tbody = document.getElementById('uptimeTable').getElementsByTagName('tbody')[0];

            uptimeData.forEach(log => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = log.host;
                row.insertCell(1).textContent = log.timestamp;
                row.insertCell(2).textContent = log.status;
            });
        };

        // Function to fetch ping results and populate the table
        const fetchPingResults = async () => {
            const response = await fetch('/results');
            const data = await response.json();
            const lastResult = data[data.length - 1]; // Get the most recent result
            const tbody = document.getElementById('pingTable').getElementsByTagName('tbody')[0];

            for (const host in lastResult.pingResults) {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = host;
                row.insertCell(1).textContent = lastResult.pingResults[host].alive ? 'Yes' : 'No';
                row.insertCell(2).textContent = lastResult.pingResults[host].responseTimes.join(', ');
            }
        };

        // Dark mode toggle functionality
        const toggleModeButton = document.getElementById('toggleMode');
        toggleModeButton.addEventListener('click', () => {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode', !isDarkMode);
            toggleModeButton.textContent = isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode';
        });

        // Fetch data on page load
        fetchSpeedTestResults();
        fetchDowntimeLogs();
        fetchUptimeLogs();
        fetchPingResults();
    </script>
</body>
</html>
